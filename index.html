<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>AIç»˜ç”»å–µ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="ä½¿ç”¨å…ˆè¿›çš„AIæŠ€æœ¯ï¼Œè½»æ¾åˆ›ä½œç‹¬ç‰¹çš„æ•°å­—è‰ºæœ¯ä½œå“ã€‚æ¢ç´¢æ— é™å¯èƒ½ï¼Œé‡Šæ”¾ä½ çš„åˆ›æ„æ½œèƒ½ã€‚">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="AIç»˜ç”»">

<!--    <link rel="icon" href="https://xx.com" type="image/png">-->
<!--    <link rel="apple-touch-icon" href="https://xx.com">-->

    <style>
        :root {
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
            --background-color: #f5f7fa;
            --text-color: #333;
            --card-background: rgba(255, 255, 255, 0.9);
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /*background: linear-gradient(135deg, var(--background-color) 0%, #c3cfe2 100%);*/
            background: linear-gradient(135deg, #e6f5ff 0%, #ffe6f5 100%);
            color: var(--text-color);
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .card {
            background-color: var(--card-background);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-align: center;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .image-container {
            width: 100%;
            max-width: 500px;
            height: 350px;
            border-radius: 10px;
            margin-bottom: 1rem;
            background-color: rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        #aiImage {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            display: none;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        select{
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }


        select:focus, input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(79, 172, 254, 0.2);
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }

        button {
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: none;
            outline: none;
        }

        .submit-btn {
            background: #cccccc;
            color: white;
            flex-grow: 1;
            margin-right: 10px;
        }

        .submit-btn.active {
            background: linear-gradient(to right, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        .submit-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .download-btn {
            background: #2ecc71;
            color: white;
        }

        .download-btn:hover {
            background: #27ae60;
        }

        .history-btn {
            background: #3498db;
            color: white;
            margin-left: 10px;
        }

        .history-btn:hover {
            background: #2980b9;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .history-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .history-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
            border-radius: 5px;
        }

        .history-item-buttons {
            margin-left: auto;
        }

        .history-item-buttons button {
            margin-left: 5px;
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .redraw-btn {
            background-color: #3498db;
            color: white;
        }

        .delete-btn {
            background-color: #e74c3c;
            color: white;
        }

        .clear-history-btn {
            background-color: #e74c3c;
            color: white;
            margin-top: 10px;
        }

        .theme-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .card {
                width: 95%;
                padding: 1.5rem;
            }

            h1 {
                font-size: 2rem;
            }

            select, input[type="text"], button {
                font-size: 0.9rem;
            }

            .image-container {
                height: 250px;
            }
        }

        @media (max-width: 480px) {
            .card {
                width: 100%;
                border-radius: 0;
            }

            h1 {
                font-size: 1.75rem;
            }

            .button-group {
                flex-direction: column;
            }

            .submit-btn, .download-btn, .history-btn {
                margin: 5px 0;
                width: 100%;
            }
        }

        .input-group {
            display: flex; /* ä½¿ç”¨ Flex å¸ƒå±€ */
            align-items: center; /* å‚ç›´å±…ä¸­å¯¹é½ */
            width: 100%; /* å æ®çˆ¶å…ƒç´ çš„å…¨éƒ¨å®½åº¦ */
             margin-bottom: 1rem;
        }

        .input-group input[type="text"] {
            width: 75%; /* è¾“å…¥æ¡†å®½åº¦è®¾ä¸º70% */
            padding: 0.75rem;
            margin-right: 1rem; /* æ·»åŠ å³è¾¹è·ä»¥ä¾¿ä¸æŒ‰é’®éš”å¼€ */
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .random-btn {
            padding: 0.75rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: none;
            outline: none;
            background-color: #3498db;
            color: white;
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
    flex-shrink: 0;      /* é˜²æ­¢æŒ‰é’®ç¼©å° */
        }

        .random-btn:hover {
            background-color: #2980b9;
        }

        /*é»‘æš—æ¨¡å¼*/
        .dark-theme {
            --background-color: #2c3e50;
            --text-color: #ecf0f1;
            --card-background: rgba(44, 62, 80, 0.9);
            background: linear-gradient(135deg, #1d2731 0%, #292e3c 100%);
        }
        /*.dark-theme select, .dark-theme input[type="text"] {*/
        .dark-theme select, .dark-theme input[type="text"], .dark-theme .custom-size-inputs input[type="number"] {
            background-color: #333; /* è¾ƒæ·±çš„èƒŒæ™¯è‰² */
            color: #fff; /* æ–‡æœ¬é¢œè‰² */
            border-color: #555; /* è¾¹æ¡†é¢œè‰² */
        }

        /* æ·»åŠ å°ºå¯¸é€‰é¡¹ */
        .size-options {
            display: flex;
            align-items: center; /* ä¿æŒå‚ç›´å±…ä¸­å¯¹é½ */
            justify-content: space-between; /* ä½¿é€‰æ‹©æ¡†å’Œè¾“å…¥æ¡†åˆ†åˆ«é å·¦å³ä¸¤ç«¯ */
            width: 100%; /* ç¡®ä¿å æ®æ•´è¡Œ */
            /*margin-top: 0.5rem;*/
        }

        .size-options label {
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
            flex-shrink: 0;      /* é˜²æ­¢æŒ‰é’®ç¼©å° */
            margin-right: 0.5rem;
        }

        .size-options select {
            width: 100%; /* é€‰æ‹©æ¡†å æ®å·¦ä¾§ç©ºé—´ */
            margin-right: 0.5rem;
        }

        .custom-size-inputs {
            display: flex;
            align-items: center;
        }

        .custom-size-inputs input[type="number"] {
            width: 50px; /* è¾“å…¥æ¡†å®½åº¦è®¾ä¸ºå›ºå®šå€¼ */
            padding: 0.75rem;
            margin-right: 0.5rem; /* æ·»åŠ å³è¾¹è·ä»¥ä¾¿ä¸æŒ‰é’®éš”å¼€ */
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            margin-bottom: 1rem;
            /*transition: all 0.3s ease;*/
        }

         /*å“åº”å¼æ ·å¼ */
        @media (max-width: 480px) {
            .size-options {
                flex-direction: column;
            }

            .size-options select {
                margin-bottom: 1rem; /* ä¸ºé€‰æ‹©æ¡†æ·»åŠ åº•éƒ¨è¾¹è· */
            }

    .custom-size-inputs {
        flex-direction: row; /* è¾“å…¥æ¡†æ°´å¹³æ’åˆ— */
        justify-content: space-between; /* è¾“å…¥æ¡†åˆ†åˆ«é å·¦å³ä¸¤ç«¯ */
        width: 100%; /* ç¡®ä¿å æ®æ•´è¡Œ */
        margin-top: 0; /* ç§»é™¤é¡¶éƒ¨è¾¹è· */
    }


            .custom-size-inputs input[type="number"] {
                margin-bottom: 0; /* ç§»é™¤åº•éƒ¨è¾¹è· */
            }
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const submitButton = document.getElementById('submitButton');
            const promptInput = document.getElementById('prompt');
            const downloadBtn = document.getElementById('downloadBtn');
            const historyBtn = document.getElementById('historyBtn');
            const modal = document.getElementById('historyModal');
            const closeBtn = document.getElementsByClassName('close')[0];
            const historyList = document.getElementById('historyList');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const themeToggle = document.getElementById('themeToggle');
            let history = JSON.parse(localStorage.getItem('aiDrawingHistory')) || [];

        function updateHistory(prompt, imageUrl) {
            history.push({ prompt: prompt, imageUrl: imageUrl, timestamp: new Date() });
            localStorage.setItem('aiDrawingHistory', JSON.stringify(history));
            renderHistory();
        }

            const prompts = ['1girl,solo,cute,in glass,atmosphere_X,best quality,beautiful,extremely detailed,masterpiece,very aesthetic',
                    'a girl,,nahida,light,full body,symbol eye, nahida,1girl,fair_skin,in summer,day,in a meadow,sky,cirrus_fibratus,intense shadows,blonde hair,pleated_dress,collared_shirt,blue eyes,long hair,fang,smile',
                    '((best quality)), ((masterpiece)),A Chinese couple in Hanfu embracing on an arch bridge, a sky full of rose petals, a romantic atmosphere, a huge moon, colorful clouds, clouds, ethereal, reflections of water, a mirage, a breeze,(Chinese ink style)',
                    'simple background, flower, signature, no humans, sparkle, leaf, plant, white flower, black background, still life, embroidery',
                    ' 1 girl,(orange light effect),hair ornament,jewelry,looking at viewer,flower,floating hair,water,underwater,air bubble,submerged, 80sDBA style',
                    'masterpiece,best quality,high quality,loli,1girl, solo, long hair, looking at viewer, blush, bangs, thighhighs, dress, ribbon, brown eyes, very long hair, closed mouth, standing, full body, yellow eyes, white hair, short sleeves, outdoors, sky,no shoes, day, puffy sleeves, looking back, cloud, from behind, white dress, white thighhighs, red ribbon, tree, blue sky, puffy short sleeves, petals, cherry blossoms, skirt hold,',
                    ' 1 girl,Clothes in the shape of snowflake,render,technology, (best quality) (masterpiece), (highly in detailed), 4K,Official art, unit 8 k wallpaper, ultra detailed, masterpiece, best quality, extremely detailed,CG,low saturation, as style, line art',
                    ' best quality,masterpiece,sculpture,wonderland,,chinese fairy tales,an old man,boiling tea,drink tea,a painting of history floating and curved in the background,mountain,white cloud,chinese style courtyard,pavilion,chinese tea mountains,, Chinese architecture, trees,,white hair ,',
                    ' 1girl, absurdres, arrow_(symbol), ata-zhubo, bicycle, billboard, black_eyes, black_footwear, black_hair, blue_sky, bridge, building, car, cardigan, city, cityscape, commentary_request, crosswalk, day, fire_hydrant, folding_bicycle, grey_cardigan, highres, lamppost, loafers, motor_vehicle, necktie, original, overpass, power_lines, railing, red_necktie, red_skirt, road, road_sign, scenery, school_uniform, shoes, short_hair, sign, skirt, sky, solo, stairs, standing, street, traffic_cone, traffic_light, truck, utility_pole, vending_machine',
                    'Steep stone walls towered into the sky, thunderous waves crashed against the river bank, and the waves stirred up like thousands of piles of white snow.',
                    '1girl, solo, elf, golden eyes, glowing eyes, slit_pupils, silver hair, green gradient hair, long hair, blunt bangs, brown capelet, frilled shirt, long sleeves, green brooch, pouch, belt, brown gloves, upper body, (chibi:0.4), (close-up), (broken:1.3),  half-closed eye, expressionless, from side,  depth of field, fallen leaves, side light, gingko, tree, masterpiece,bestquality, line art,',
                    'flower, outdoors, sky, tree, no humans, window, bird, building, scenery, house,oil painting style',
                    ' (masterpiece,top quality,best quality,official art,beautiful and aesthetic:1.2),gf-hd,1girl,loli,solo,long hair,lovely smilie,(wink),(blazer,white shirt,white blouse:2),cozy,(lace details),v,robinSR,love heart',
                    ' moon,outdoors,full moon,night,flower,cherry blossoms,sky,tree,pink flower flying around,night sky,no humans,masterpiece,illustration,extremely fine and beautiful,perfect details,stream,',

                ];

            // éšæœºé€‰æ‹©ä¸€ä¸ªæç¤ºè¯
            function getRandomPrompt() {
                const randomIndex = Math.floor(Math.random() * prompts.length);
                return prompts[randomIndex];
            }

                // éšæœºæç¤ºè¯æŒ‰é’®
            const randomButton = document.getElementById('randomButton');
            randomButton.addEventListener('click', function () {
                const randomPrompt = getRandomPrompt();
                promptInput.value = randomPrompt;
                promptInput.dispatchEvent(new Event('input')); // è§¦å‘ input äº‹ä»¶
            });
  function setupSizeOptions() {
    const sizeSelect = document.getElementById('size-select');
    const widthInput = document.getElementById('width-input');
    const heightInput = document.getElementById('height-input');

    // ç›‘å¬è¾“å…¥æ¡†çš„å˜åŒ–ï¼Œé™åˆ¶æœ€å¤§å€¼ä¸º1024
    widthInput.addEventListener('input', function () {
        if (parseInt(this.value) > 1024) {
            this.value = 1024;
        }
    });

    heightInput.addEventListener('input', function () {
        if (parseInt(this.value) > 1024) {
            this.value = 1024;
        }
    });
    sizeSelect.addEventListener('change', function () {
        const selectedValue = this.value;

        // å¦‚æœé€‰æ‹©äº†è‡ªå®šä¹‰ï¼Œåˆ™å¯ç”¨è¾“å…¥æ¡†
        if (selectedValue === 'custom') {
            widthInput.disabled = false;
            heightInput.disabled = false;
            return;
        }

        // å¦åˆ™ç¦ç”¨è¾“å…¥æ¡†å¹¶æ ¹æ®é€‰æ‹©çš„å°ºå¯¸è®¾ç½®é»˜è®¤å€¼
        widthInput.disabled = true;
        heightInput.disabled = true;

        switch (selectedValue) {
            case '16x9-horizontal':
                widthInput.value = 1024;
                heightInput.value = 576;
                break;
            case '16x9-vertical':
                widthInput.value = 576;
                heightInput.value = 1024;
                break;
            case '4x3-horizontal':
                widthInput.value = 1024;
                heightInput.value = 768;
                break;
            case '4x3-vertical':
                widthInput.value = 768;
                heightInput.value = 1024;
                break;
            case '1x1':
                widthInput.value = 1024;
                heightInput.value = 1024;
                break;
            default:
                widthInput.value = 1024;
                heightInput.value = 576;
                break;
        }
    });
}
setupSizeOptions()
            function renderHistory() {
                historyList.innerHTML = '';
                history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <img src="${item.imageUrl}" alt="${item.prompt}">
                        <div>
                            <span>${item.prompt}</span>
                            <br>
                            <small>${new Date(item.timestamp).toLocaleString()}</small>
                        </div>
                        <div class="history-item-buttons">
                            <button class="redraw-btn tooltip" data-index="${index}">é‡ç»˜<span class="tooltiptext">ä½¿ç”¨æ­¤æç¤ºè¯é‡æ–°ç”Ÿæˆå›¾ç‰‡</span></button>
                            <button class="delete-btn tooltip" data-index="${index}">åˆ é™¤<span class="tooltiptext">ä»å†å²è®°å½•ä¸­åˆ é™¤æ­¤é¡¹</span></button>
                        </div>
                    `;
                    historyList.appendChild(historyItem);
                });
            }

            function deleteHistoryItem(index) {
                history.splice(index, 1);
                localStorage.setItem('aiDrawingHistory', JSON.stringify(history));
                renderHistory();
            }

            function clearHistory() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                    history = [];
                    localStorage.removeItem('aiDrawingHistory');
                    renderHistory();
                }
            }


            async function generateImage(prompt, width, height) { // ä¿®æ”¹å‡½æ•°ç­¾åä»¥æ¥æ”¶å®½åº¦å’Œé«˜åº¦
                submitButton.disabled = true;
                submitButton.textContent = 'æ­£åœ¨åˆ›ä½œ...';
                document.querySelector('.loading-overlay').style.display = 'flex';

                const model = document.getElementById('model').value;
                const resolution = {
                    width: parseInt(width), // ä½¿ç”¨ä»å‚æ•°æ¥æ”¶çš„å®½åº¦
                    height: parseInt(height) // ä½¿ç”¨ä»å‚æ•°æ¥æ”¶çš„é«˜åº¦
                };


                try {
                    const controller = new AbortController();
                    const signal = controller.signal;

                    setTimeout(() => {
                        controller.abort();
                    }, 30000);

                    const response = await fetch(`${window.location.origin}/generate`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            'model': model,
                            'prompt': prompt,
                            'resolution': resolution
                        }),
                        signal: signal
                    });

                    if (!response.ok) {
                        throw new Error(`è¯·æ±‚å¤±è´¥ï¼š${response.status} ${response.statusText}`);
                    }

                    const blob = await response.blob();
                    const imageUrl = await uploadToImageHost(blob);
                    // const Image = await blobToBase64(blob);
                    // console.log('Base64 Image:', Image);
                    console.log('Imageurl:', imageUrl);
                    document.getElementById('aiImage').src = imageUrl;
                    updateHistory(prompt, imageUrl);
                    downloadBtn.style.display = 'block';
                } catch (error) {
                    if (error.name === 'AbortError') {
                        alert('æœåŠ¡å™¨è¿æ¥è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•ã€‚');
                    } else {
                        console.error('Error:', error);
                        alert('ç”Ÿæˆè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•ã€‚');
                    }
                } finally {
                    submitButton.textContent = 'å¼€å§‹åˆ›ä½œ';
                    submitButton.disabled = false;
                    document.querySelector('.loading-overlay').style.display = 'none';
                }
            }

            async function uploadToImageHost(blob) {
                const formData = new FormData();
                formData.append("file", blob, 'generated-image.png'); // ä½¿ç”¨æ–‡ä»¶å

                const headers = new Headers();
                headers.append(      "contentType", 'multipart/form-data',
                    "User-Agent",  navigator.userAgent);

                const requestOptions = {
                    method: 'POST',
                    headers: headers,
                    body: formData,
                    redirect: 'follow'
                };

                try {
                    const response = await fetch(`${window.location.origin}/upload`, requestOptions);

                    if (!response.ok) {
                        throw new Error(`ä¸Šä¼ å¤±è´¥ï¼š${response.status} ${response.statusText}`);
                    }

                    // å‡è®¾æœåŠ¡å™¨è¿”å›çš„æ˜¯ JSON æ ¼å¼
                    const result = await response.json();

                    // å¦‚æœæœåŠ¡å™¨è¿”å›çš„æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„ URLï¼Œåˆ™å¯ä»¥ä½¿ç”¨ response.text()
                    // const result = await response.text();

                    return `${window.location.origin}${result[0].src}`;
                } catch (error) {
                    console.error('Upload Error:', error);
                    throw error;
                }
            }
// async function uploadToImageHost(blob) {
//     return new Promise((resolve, reject) => {
//         const formData = new FormData();
//         formData.append("file", blob, 'generated-image.png'); // ä½¿ç”¨æ–‡ä»¶å
//
//         const xhr = new XMLHttpRequest();
//         xhr.open('POST', 'https://img.foxhank.top/upload', true);
//         xhr.withCredentials = false; // é¿å…é¢„æ£€è¯·æ±‚
//
//         // è®¾ç½®è¯·æ±‚å®Œæˆçš„å›è°ƒå‡½æ•°
//         xhr.onload = function () {
//             if (xhr.status >= 200 && xhr.status < 300) {
//                 try {
//                     // å°è¯•è§£æ JSON æ•°æ®
//                     const result = JSON.parse(xhr.responseText);
//                     if (result && Array.isArray(result) && result[0].src) {
//                         resolve(`https://img.foxhank.top${result[0].src}`);
//                     } else {
//                         reject(new Error('æœåŠ¡å™¨è¿”å›çš„æ•°æ®ä¸ç¬¦åˆé¢„æœŸæ ¼å¼'));
//                     }
//                 } catch (error) {
//                     reject(new Error(`æ— æ³•è§£ææœåŠ¡å™¨å“åº”: ${xhr.responseText}`));
//                 }
//             } else {
//                 reject(new Error(`ä¸Šä¼ å¤±è´¥ï¼š${xhr.status} ${xhr.statusText}`));
//             }
//         };
//
//         // è®¾ç½®é”™è¯¯å¤„ç†
//         xhr.onerror = function () {
//             reject(new Error('ç½‘ç»œé”™è¯¯'));
//         };
//
//         // å‘é€è¯·æ±‚
//         xhr.send(formData);
//     });
// }

            promptInput.addEventListener('input', function() {
                if (this.value.trim() !== '') {
                    submitButton.classList.add('active');
                } else {
                    submitButton.classList.remove('active');
                }
            });

            submitButton.addEventListener('click', function (event) {
                event.preventDefault();
                if (promptInput.value.trim() === '') {
                    alert('è¯·è¾“å…¥æè¿°è¯');
                    return;
                }
                 generateImage(promptInput.value.trim(), document.getElementById('width-input').value, document.getElementById('height-input').value);
            });

            downloadBtn.addEventListener('click', function() {
                const image = document.getElementById('aiImage');
                const link = document.createElement('a');
                link.href = image.src;
                link.download = `ai-artwork-${new Date().toISOString()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
            historyBtn.onclick = function() {
                modal.style.display = 'block';
                renderHistory();
            }

            closeBtn.onclick = function() {
                modal.style.display = 'none';
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }

            historyList.addEventListener('click', function(event) {
                if (event.target.classList.contains('redraw-btn')) {
                    const index = event.target.getAttribute('data-index');
                    const prompt = history[index].prompt;
                    promptInput.value = prompt;
                    modal.style.display = 'none';
                    generateImage(prompt);
                } else if (event.target.classList.contains('delete-btn')) {
                    const index = event.target.getAttribute('data-index');
                    deleteHistoryItem(index);
                }
            });

            clearHistoryBtn.addEventListener('click', clearHistory);

            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-theme');
                themeToggle.textContent = document.body.classList.contains('dark-theme') ? 'ğŸŒ' : 'ğŸŒ™';
                localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
            });

            // æ£€æŸ¥å¹¶åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
            if (localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-theme');
                themeToggle.textContent = 'ğŸŒ';
            }

            const blobToBase64 = (blob) => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onerror = reject;
                reader.onload = () => {
                    resolve(reader.result);
                };
                reader.readAsDataURL(blob);
            });

            // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
            document.addEventListener('keydown', function(event) {
                if (event.ctrlKey && event.key === 'Enter') {
                    submitButton.click();
                }
            });

            // æ·»åŠ æ‹–æ”¾æ”¯æŒ
            const dropZone = document.querySelector('.image-container');
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.border = '2px dashed #4facfe';
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.style.border = 'none';
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.border = 'none';
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('aiImage').src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>AIç»˜ç”»åˆ›ä½œå¹³å°</h1>
            <div class="image-container">
                <img id="aiImage"
                     src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg=="
                     alt="AIç”Ÿæˆçš„å›¾ç‰‡">
                <div class="loading-overlay">
                    <div class="loading-spinner"></div>
                </div>
            </div>
            <select id="model">
                <option value="dreamshaper-8-lcm">DreamShaper 8 LCM</option>
                <option value="stable-diffusion-xl-base-1.0" selected>Stable Diffusion XL Base 1.0</option>
                <option value="stable-diffusion-xl-lightning">Stable Diffusion XL Lightning</option>
                <option value="stable-diffusion-v1-5-inpainting">123</option>>
            </select>

            <div class="input-group">
    <input type="text" id="prompt" placeholder="è¯·è¾“å…¥ä½ æƒ³è¦åˆ›ä½œçš„ç”»é¢æè¿°...">
    <button id="randomButton" class="button random-btn">éšæœºæç¤ºè¯</button>
</div>
            <!-- æ·»åŠ å°ºå¯¸é€‰æ‹©åŠŸèƒ½ -->
<div class="size-options">
    <label for="size-select">å°ºå¯¸:</label>
    <select id="size-select">
        <option value="16x9-horizontal">æ¨ªå± 16:9</option>
        <option value="16x9-vertical">ç«–å± 16:9</option>
        <option value="4x3-horizontal">æ¨ªå± 4:3</option>
        <option value="4x3-vertical">ç«–å± 4:3</option>
        <option value="1x1">æ­£æ–¹å½¢ 1:1</option>
        <option value="custom">è‡ªå®šä¹‰</option>
    </select>

    <!-- è‡ªå®šä¹‰è¾“å…¥æ¡† -->
    <div class="custom-size-inputs">
        <label for="width-input">å®½åº¦</label>
        <input type="number" id="width-input" min="1" max="1024" value="1024" placeholder="å®½åº¦" disabled>
        <label for="height-input">é«˜åº¦</label>
        <input type="number" id="height-input" min="1" max="1024" value="576" placeholder="é«˜åº¦" disabled>
    </div>
</div>
            <div class="button-group">
                <button type="button" class="submit-btn" id="submitButton">å¼€å§‹åˆ›ä½œ</button>
                <button type="button" class="download-btn" id="downloadBtn" style="display: none;">ä¸‹è½½å›¾ç‰‡</button>
                <button type="button" class="history-btn" id="historyBtn">å†å²è®°å½•</button>
            </div>
        </div>
    </div>

    <div id="historyModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>å†å²è®°å½•</h2>
            <div id="historyList"></div>
            <button id="clearHistoryBtn" class="clear-history-btn">æ¸…ç©ºå†å²è®°å½•</button>
        </div>
    </div>

    <button id="themeToggle" class="theme-toggle">ğŸŒ™</button>
</body>
</html>